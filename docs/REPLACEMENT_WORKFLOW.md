# 🔄 模块替换工作流程

> 逐个评估，选择性替换 - 完整操作手册

## 📋 工作流程总览

```
第1步：评估模块   →   第2步：备份代码   →   第3步：生成新代码   →   第4步：测试验证   →   第5步：部署上线
  (2小时/批)         (5分钟)             (30分钟/模块)        (20分钟/模块)      (10分钟)
```

**总耗时**：每批 5 个模块约 4-5 小时（按优先级分批处理）

---

## 🎯 第1步：模块评估

### 使用评估工具

```bash
# 启动交互式评估工具
bash scripts/evaluate-module.sh
```

**操作流程**：
1. 选择评估模式 → 输入 `1`（交互式评估）
2. 选择要评估的模块 → 输入序号（1-38）
3. 回答功能检查问题 → y/n/skip
4. 输入各维度评分 → 0.2/0.4/0.6/0.8/1.0
5. 查看评估结果和改进建议
6. 决定是否立即生成优化代码

### 评估标准快速参考

| 总分 | 等级 | 改进方案 | 优先级 |
|------|------|---------|--------|
| 4.5-5.0 | ⭐⭐⭐⭐⭐ 优秀 | 🟢 保持现状 | 低 |
| 3.5-4.4 | ⭐⭐⭐⭐☆ 良好 | 🟡 小幅优化 | 中 |
| 2.5-3.4 | ⭐⭐⭐☆☆ 一般 | 🟡 选择性重写 | 中 |
| 1.5-2.4 | ⭐⭐☆☆☆ 较差 | 🔴 强烈建议重写 | 高 |
| 0.0-1.4 | ⭐☆☆☆☆ 极差 | 🔴 必须重写 | 高 |

### 示例：评估客户管理模块

```bash
$ bash scripts/evaluate-module.sh

选择模式 [1-4]: 1
模块序号 [1-38]: 1  # 选择客户管理

# 功能完整性检查
列表查询（支持分页） [y/n]: y
搜索功能（至少2个字段） [y/n]: y
筛选功能（下拉框等） [y/n]: n  # 缺失
新增功能（完整表单） [y/n]: y
编辑功能（数据回显） [y/n]: y
删除功能（确认对话框） [y/n]: y
详情查看 [y/n]: n  # 缺失
批量操作 [y/n/skip]: skip
数据导出 [y/n/skip]: skip

# 结果：功能完整性得分 0.71 / 1.0

UI 美观度得分 [0.2-1.0]: 0.4  # 简陋
代码质量得分 [0.2-1.0]: 0.6  # 一般
用户体验得分 [0.2-1.0]: 0.4  # 较差
响应式+功能得分 [0.2-1.0]: 0.2  # 不支持

━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 评估结果
━━━━━━━━━━━━━━━━━━━━━━━━━━━━

总分：2.31 / 5.0
⭐⭐☆☆☆ 较差 - 强烈建议重写
改进方案：重写
优先级：🔴 高
```

---

## 🎯 第2步：备份代码

### 2.1 创建备份分支

```bash
# 1. 创建备份分支（首次执行）
git checkout -b backup/original-modules-$(date +%Y%m%d)

# 2. 提交当前状态
git add .
git commit -m "backup: 备份原始38个模块（评估前）"

# 3. 推送到远程
git push origin backup/original-modules-$(date +%Y%m%d)

# 4. 切回工作分支
git checkout claude/evaluate-code-templates-erp-011CUkAJyxAapCkDyYS2S7j8
```

### 2.2 备份单个模块文件

如果只替换部分模块：

```bash
# 备份要替换的模块
cp src/views/CustomerManagement.vue src/views/CustomerManagement.vue.backup
# 或
mv src/views/CustomerManagement.vue src/views/CustomerManagement.old.vue
```

### 2.3 记录模块依赖

**重要**：在替换前记录模块的特殊依赖和业务逻辑

创建文件：`docs/module-dependencies.md`

```markdown
## 客户管理模块

### 特殊业务逻辑
- 客户编号自动生成规则：CUS + 年月 + 3位序号
- VIP客户自动标记（订单金额 > 100万）

### 后端 API 依赖
- GET /api/v1/customers（不是 /api/customers）
- 响应格式：{ code: 200, data: {...}, msg: '' }

### 第三方集成
- 集成企业微信推送（新增客户时）

### 特殊权限
- 只有销售经理可以删除客户
- 财务部门只能查看，不能编辑
```

---

## 🎯 第3步：生成新代码

### 3.1 使用评估工具生成提示词

评估完成后，工具会自动生成 Claude Code 提示词：

```
生成优化代码 [y/n]: y

━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🚀 生成 Claude Code 提示词
━━━━━━━━━━━━━━━━━━━━━━━━━━━━

复制以下提示词到 Claude Code：

生成 客户管理 模块的优化版本

**当前问题**：
- 功能完整性：0.71/1.0（缺少筛选和详情功能）
- UI 美观度：0.4/1.0（界面简陋）
- 代码质量：0.6/1.0（可读性差）
- 用户体验：0.4/1.0（缺少加载状态和友好提示）
- 响应式：0.2/1.0（不支持移动端）

...（完整提示词）
```

### 3.2 在 Claude Code 中生成代码

**直接在当前对话中说**：

```
（粘贴上方提示词）
```

或者使用标准化提示词：

```
重新生成客户管理模块，要求：

1. 完整功能：
   - 列表查询（分页）
   - 高级搜索（客户名称、类型、状态）
   - 新增/编辑/删除/详情查看
   - 数据导出（Excel）

2. UI 优化：
   - 使用紫色渐变主题
   - 卡片圆角和阴影
   - 精美的页面头部
   - 流畅的动画效果

3. 用户体验：
   - 加载状态提示
   - 操作成功/失败反馈
   - 确认对话框
   - 友好的错误提示

4. 响应式布局：
   - 支持桌面端（>=1024px）
   - 支持平板（768-1024px）
   - 支持手机（<768px）

5. 保留特殊业务逻辑：
   - 客户编号生成规则：CUS + 年月 + 3位序号
   - VIP 客户自动标记
   - 企业微信推送集成接口

6. API 接口适配：
   - 使用 /api/v1/customers（不是 /api/customers）
   - 响应格式：{ code: 200, data: {...}, msg: '' }

参考模板：src/views/modules/CustomerManagement.vue

请生成完整代码。
```

### 3.3 保存生成的代码

```bash
# Claude Code 会自动保存到指定路径
# 或手动保存：
# src/views/CustomerManagement.vue（替换原文件）
# 或
# src/views/modules/CustomerManagementNew.vue（先测试）
```

---

## 🎯 第4步：测试验证

### 4.1 本地开发环境测试

```bash
# 1. 启动开发服务器
npm run serve

# 2. 浏览器访问
http://localhost:8080/#/customer-management

# 3. 功能测试清单
```

**测试清单**（复制到 docs/test-checklist.md）：

```markdown
## 客户管理模块测试清单

### 基础功能测试
- [ ] 页面加载正常，无控制台错误
- [ ] 列表数据显示正常
- [ ] 分页功能正常（切换页码、每页条数）
- [ ] 搜索功能正常（输入关键词、清空搜索）
- [ ] 筛选功能正常（下拉框、状态切换）

### CRUD 操作测试
- [ ] **新增**：打开对话框 → 填写表单 → 验证规则 → 提交成功
- [ ] **编辑**：点击编辑 → 数据回显 → 修改保存 → 列表更新
- [ ] **删除**：点击删除 → 确认对话框 → 删除成功 → 列表更新
- [ ] **详情**：点击查看 → 显示完整信息 → 关闭

### 表单验证测试
- [ ] 必填项验证（客户名称、联系人、电话）
- [ ] 格式验证（手机号、邮箱）
- [ ] 提交前验证（红色提示）
- [ ] 验证通过后才能提交

### 用户体验测试
- [ ] 加载时显示 loading 状态
- [ ] 操作成功显示绿色提示
- [ ] 操作失败显示红色错误提示
- [ ] 删除前有确认对话框
- [ ] 空数据显示友好提示

### UI/UX 测试
- [ ] 页面美观，使用紫色渐变主题
- [ ] 按钮有悬停效果
- [ ] 卡片有圆角和阴影
- [ ] 图标显示正确
- [ ] 间距和对齐合理

### 响应式测试
- [ ] 桌面端（1920px）显示正常
- [ ] 平板端（768px）布局适配
- [ ] 手机端（375px）可正常使用
- [ ] 横屏/竖屏切换正常

### 特殊业务逻辑测试
- [ ] 客户编号自动生成（CUS + 年月 + 序号）
- [ ] VIP 客户自动标记
- [ ] 企业微信推送触发（如已集成）

### API 集成测试（如有后端）
- [ ] 列表查询接口正常
- [ ] 新增接口正常
- [ ] 编辑接口正常
- [ ] 删除接口正常
- [ ] 错误处理正常（网络错误、业务错误）

### 性能测试
- [ ] 页面加载速度 < 2秒
- [ ] 列表渲染流畅（100条数据）
- [ ] 无内存泄漏（切换模块后内存释放）
- [ ] 无卡顿和闪烁

### 兼容性测试
- [ ] Chrome 最新版
- [ ] Firefox 最新版
- [ ] Safari 最新版（如Mac可用）
- [ ] Edge 最新版

---

**测试结果**：
- 通过：___ / 总计
- 失败：___ 项
- 是否可以上线：✅ / ❌

**问题记录**：
1.
2.
3.
```

### 4.2 对比新旧版本

```bash
# 并排对比（如果保留了旧版本）
# 旧版：http://localhost:8080/#/customer-management-old
# 新版：http://localhost:8080/#/customer-management

# 记录改进点：
# 1. UI 更精美（渐变色、圆角）
# 2. 功能更完整（新增筛选、详情）
# 3. 体验更好（加载状态、友好提示）
# 4. 支持响应式
```

### 4.3 修复问题

如果测试中发现问题：

```
在 Claude Code 中说：

"客户管理模块测试发现以下问题：

1. 删除功能报错：Cannot read property 'id' of undefined
   位置：CustomerManagement.vue:423

2. 搜索后分页不会重置到第一页
   期望：搜索后从第1页显示
   实际：停留在当前页

3. 移动端表格横向滚动条不显示
   设备：iPhone 12 Pro（375px）

请修复这些问题。"
```

---

## 🎯 第5步：部署上线

### 5.1 提交代码

```bash
# 1. 查看更改
git status
git diff src/views/CustomerManagement.vue

# 2. 添加到暂存区
git add src/views/CustomerManagement.vue

# 3. 提交
git commit -m "feat: 优化客户管理模块

- 新增筛选和详情查看功能
- UI 美化（渐变色、圆角、阴影）
- 改善用户体验（加载状态、友好提示）
- 支持响应式布局
- 完善错误处理

评分提升：2.31 → 4.8 (预计)
测试通过：38/38 项"

# 4. 推送到远程
git push origin claude/evaluate-code-templates-erp-011CUkAJyxAapCkDyYS2S7j8
```

### 5.2 构建生产版本

```bash
# 1. 构建
npm run build

# 2. 检查构建产物
ls -lh dist/

# 3. 本地测试生产版本
npx serve dist
# 访问 http://localhost:3000
```

### 5.3 部署到服务器

```bash
# 根据你的部署方式：

# 方式 A：FTP/SFTP 上传
# 上传 dist/ 目录到服务器

# 方式 B：使用 Git 部署
git push production main  # 推送到生产环境

# 方式 C：Docker 部署
docker build -t qianjin-erp:latest .
docker push qianjin-erp:latest

# 方式 D：自动化部署（如已配置）
./deploy.sh
```

### 5.4 生产环境验证

```bash
# 1. 访问生产环境
https://your-domain.com/#/customer-management

# 2. 烟雾测试
- 页面加载正常
- 基本功能可用
- 无控制台错误

# 3. 监控错误日志
tail -f /var/log/nginx/error.log
```

---

## 📊 批量替换计划

### 第一批：高优先级模块（Week 1）

**目标**：替换 5 个得分最低的核心模块

| 模块 | 当前得分 | 预期得分 | 预计耗时 | 负责人 | 完成日期 |
|------|---------|---------|---------|--------|---------|
| 客户管理 | 2.3 | 4.8 | 3 小时 | | Day 1 |
| 订单管理 | 2.1 | 4.9 | 3.5 小时 | | Day 2 |
| 报价管理 | 2.5 | 4.7 | 3 小时 | | Day 3 |
| 发票管理 | 1.8 | 4.9 | 4 小时 | | Day 4 |
| 库存管理 | 2.2 | 4.8 | 3.5 小时 | | Day 5 |

**总耗时**：17 小时
**工作日安排**：每天 3-4 小时，5 个工作日完成

---

### 第二批：中优先级模块（Week 2）

**目标**：优化 8 个得分中等的业务模块

| 模块 | 当前得分 | 改进方式 | 预计耗时 |
|------|---------|---------|---------|
| 员工管理 | 3.2 | 部分重写 | 2 小时 |
| 考勤打卡 | 3.4 | 优化 UI | 1.5 小时 |
| 合同管理 | 3.0 | 功能补充 | 2 小时 |
| 会议纪要 | 3.3 | 优化 UX | 1.5 小时 |
| 销售业绩 | 3.1 | 重写 | 2.5 小时 |
| 财务分析 | 3.2 | 优化图表 | 2 小时 |
| 项目跟踪 | 3.4 | 小幅调整 | 1 小时 |
| 交付管理 | 3.0 | 功能增强 | 2 小时 |

**总耗时**：14.5 小时

---

### 第三批：低优先级模块（Week 3-4）

**目标**：完善剩余模块

根据第一、二批的经验，快速处理剩余 25 个模块。

**策略**：
- 得分 > 3.5：保持现状或微调（每个 0.5 小时）
- 得分 2.5-3.5：参考已优化模块快速改进（每个 1.5 小时）
- 得分 < 2.5：完全重写（每个 3 小时）

**预计总耗时**：30-40 小时

---

## 📋 进度追踪表

### 每日更新进度

| 日期 | 已完成 | 进行中 | 待处理 | 当日耗时 | 累计耗时 |
|------|--------|--------|--------|---------|---------|
| Day 1 | 客户管理 | - | 37 | 3h | 3h |
| Day 2 | 订单管理 | - | 36 | 3.5h | 6.5h |
| Day 3 | 报价管理 | - | 35 | 3h | 9.5h |
| ... | ... | ... | ... | ... | ... |

### 里程碑

- [ ] **Milestone 1**：完成前 5 个高优先级模块（Week 1）
- [ ] **Milestone 2**：完成前 13 个核心模块（Week 2）
- [ ] **Milestone 3**：完成所有需要重写的模块（Week 3）
- [ ] **Milestone 4**：完成所有 38 个模块的优化（Week 4）

---

## 🚨 常见问题处理

### Q1: 新代码破坏了现有功能怎么办？

**解决方案**：
```bash
# 快速回滚到备份版本
git checkout src/views/CustomerManagement.vue.backup src/views/CustomerManagement.vue

# 或从备份分支恢复
git checkout backup/original-modules-20250103 -- src/views/CustomerManagement.vue
```

### Q2: 如何保留特殊业务逻辑？

**解决方案**：
1. 在生成代码前，详细说明特殊逻辑
2. 从旧代码中提取关键函数
3. 手动合并到新代码中

```javascript
// 从旧代码提取
function generateCustomerId() {
  const now = new Date();
  const yearMonth = `${now.getFullYear()}${(now.getMonth() + 1).toString().padStart(2, '0')}`;
  // ... 特殊逻辑
  return `CUS${yearMonth}${序号}`;
}

// 合并到新代码的相应位置
```

### Q3: API 接口路径不一致怎么办？

**解决方案**：
```javascript
// 创建统一的 API 配置文件
// src/api/config.js
export const API_BASE = '/api/v1';
export const API_ENDPOINTS = {
  customers: `${API_BASE}/customers`,
  orders: `${API_BASE}/orders`,
  // ...
};

// 在组件中使用
import { API_ENDPOINTS } from '@/api/config';
axios.get(API_ENDPOINTS.customers);
```

### Q4: 生成的代码不符合团队规范怎么办？

**解决方案**：
1. 在 Claude Code 提示词中明确说明团队规范
2. 使用 ESLint 自动格式化
3. Code Review 后统一调整

```bash
# 自动格式化
npm run lint -- --fix
```

### Q5: 如何确保没有遗漏任何模块？

**解决方案**：
使用清单逐一勾选：

```bash
# 查看评估结果
cat docs/evaluation-results.txt | wc -l
# 应该是 38 行（如果全部评估完成）

# 查看待处理模块
grep "方案:重写" docs/evaluation-results.txt
```

---

## 🎯 成功标准

### 单个模块替换成功标准

- ✅ 评分从 < 3.0 提升到 > 4.5
- ✅ 测试清单通过率 > 95%
- ✅ 用户反馈良好
- ✅ 无线上故障
- ✅ 性能指标正常

### 整体项目成功标准

- ✅ 38 个模块全部评估完成
- ✅ 高优先级模块（得分 < 2.5）全部重写
- ✅ 平均分从 ~2.5 提升到 > 4.0
- ✅ 用户满意度提升
- ✅ 代码可维护性提升

---

## 📞 需要帮助？

在替换过程中遇到任何问题，直接在 Claude Code 中询问：

```
"客户管理模块替换时遇到问题：
[详细描述问题]

请帮我解决。"
```

---

**工作流程版本**：v1.0
**创建日期**：2025-11-03
**最后更新**：2025-11-03
